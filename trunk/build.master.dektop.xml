<?xml version="1.0"?>
<project name="svn-oliv" basedir="." default="help">
  
  <property file="build.properties"/>
  
  <target name="all" depends="core, te, parser, charts, almanac, nmea.reader, almanac.tools, tide.implementation, sailfax, google.locator, chart.lib, star.finder, desktop"/>
  
  <target name="clean.all">
    <ant antfile="build.core.xml" target="clean" dir="."/>  
    <ant antfile="build.te.xml" target="clean" dir="."/>  
    <ant antfile="build.parser.xml" target="clean" dir="."/>  
    <ant antfile="build.charts.xml" target="clean" dir="."/>  
    <ant antfile="build.almanac.xml" target="clean" dir="."/>  
    <ant antfile="build.nmea.reader.xml" target="clean" dir="."/>  
    <ant antfile="build.almanac.tools.xml" target="clean" dir="."/>  
    <ant antfile="build.te.impl.xml" target="clean" dir="."/>  
    <ant antfile="build.sailfax.xml" target="clean" dir="."/>  
    <ant antfile="build.google.locator.xml" target="clean" dir="."/>  
    <ant antfile="build.chart.lib.xml" target="clean" dir="."/>  
    <ant antfile="build.star.finder.xml" target="clean" dir="."/>  
    <ant antfile="build.desktop.xml" target="clean" dir="."/>  
    <delete dir="classes"/>  
    <delete dir="all-libs"/>  
  </target>
  
  <target name="core">
    <echo message="Making CoreUtilities"/>
    <ant antfile="build.core.xml" target="all" dir="."/>  
  </target>
  
  <target name="te">
    <echo message="Making TideEngine"/>
    <ant antfile="build.te.xml" target="all" dir="."/>  
  </target>

  <target name="parser">
    <echo message="Making NMEAParser"/>
    <ant antfile="build.parser.xml" target="all" dir="."/>  
  </target>

  <target name="sailfax">
    <echo message="Making SailFax"/>
    <ant antfile="build.sailfax.xml" target="all" dir="."/>  
  </target>

  <target name="star.finder">
    <echo message="Making Star Finder"/>
    <ant antfile="build.star.finder.xml" target="all" dir="."/>  
  </target>

  <target name="chart.lib">
    <echo message="Making Chart Library"/>
    <ant antfile="build.chart.lib.xml" target="all" dir="."/>  
  </target>

  <target name="google.locator">
    <echo message="Making Google Locator"/>
    <ant antfile="build.google.locator.xml" target="all" dir="."/>  
  </target>

  <target name="nmea.reader">
    <echo message="Making NMEAReader"/>
    <ant antfile="build.nmea.reader.xml" target="all" dir="."/>  
  </target>

  <target name="charts">
    <echo message="Making ChartComponents"/>
    <ant antfile="build.charts.xml" target="all" dir="."/>  
  </target>

  <target name="almanac">
    <echo message="Making Almanac"/>
    <ant antfile="build.almanac.xml" target="all" dir="."/>  
  </target>

  <target name="almanac.tools">
    <echo message="Making Almanac Tools"/>
    <ant antfile="build.almanac.tools.xml" target="all" dir="."/>  
  </target>

  <target name="tide.implementation">
    <echo message="Making Tide Implementation"/>
    <ant antfile="build.te.impl.xml" target="all" dir="."/>  
  </target>
  
  <target name="desktop">
    <echo message="Making Navigation Desktop"/>
    <ant antfile="build.desktop.xml" target="all" dir="."/>  
  </target>
  
  <target name="run.config">
    <echo message="Copying configuration files"/>
	
    <mkdir dir="../all-db"/>
    <!--mkdir dir="./xml.data"/-->
    <patternset id="chart.db.patterns">
      <include name="**/CHART.*"/>
    </patternset>
    <patternset id="places.xml">
      <include name="**/places.xml"/>
    </patternset>
    <patternset id="deviation.curve">
      <include name="**/zero-deviation.csv"/>
    </patternset>
    <patternset id="sailfax.xml">
      <include name="**/pac-fax-data.xml"/>
    </patternset>
    <!--patternset id="tide.data">
      <include name="**/*.*"/>
    </patternset-->
    <!--patternset id="tide.sql">
      <include name="**/TIDES.*"/>
    </patternset-->
    <patternset id="log.db">
      <include name="**/LOG.*"/>
    </patternset>

    <copy todir="../all-db">
      <fileset dir="src.chart.lib/sql" >
        <patternset refid="chart.db.patterns"/>
      </fileset>
    </copy>
    <!--copy todir="../all-db">
      <fileset dir="src.te.impl/all-db">
        <patternset refid="tide.sql"/>
      </fileset>
    </copy-->
    <copy todir="../all-db">
      <fileset dir="src.nmeareader/log-db">
        <patternset refid="log.db"/>
      </fileset>
    </copy>
    <copy todir=".">
      <fileset dir="src.chart.lib/sql" >
        <patternset refid="places.xml"/>
      </fileset>
    </copy>
    <copy todir=".">
      <fileset dir="src.nmeareader" >
        <patternset refid="deviation.curve"/>
      </fileset>
    </copy>
    <copy todir=".">
      <fileset dir="src.sailfax" >
        <patternset refid="sailfax.xml"/>
      </fileset>
    </copy>
    <!--copy todir="./xml.data">
      <fileset dir="src.te.impl/xml.data" >
        <patternset refid="tide.data"/>
      </fileset>
    </copy-->

  </target>

  <target name="run.desktop" depends="run.config">
	<path id="3rd.classpath">
	  <fileset dir="all-3rd-party">
	    <include name="**/*.jar"/>
	  </fileset>
	</path>  
	<path id="classpath">
	  <fileset dir="all-libs">
	    <include name="**/*.jar"/>
	  </fileset>
	</path>  
    <path id="desktop.classpath">
      <path refid="3rd.classpath"/>
      <path refid="classpath"/>
    </path>
    <java classname="olivsoftdesktop.OlivSoftDesktop" dir="." fork="yes">
      <classpath refid="desktop.classpath"/>
	  <!--jvmarg line="-Dtide.flavor=xml -client -XX:NewSize=1024m -XX:MaxNewSize=1024m -Xmn1536m -Xms2048m -Xmx2048m -XX:SurvivorRatio=1 -XX:PermSize=30m -XX:+UseParallelGC -Dwith.logger=true -Dwith.journal=true"/-->
	  <jvmarg line="-client -Djava.library.path=all-3rd-party/rxtx.distrib/${system.type} -Dtide.flavor=xml -Dwith.logger=true -Dwith.journal=true"/>
    </java>
  </target>

  <target name="help">
    <echo>
      Will check out the required project from http://code.google.com,
      compile and archive them.
      
      The required projects are:
      - coreutilities
      - java-tide-engine
      - javanmeaparser
      - chartcomponents
      - javanauticalalmanac
	  - almanac-related-tools
      - tide-engine-implementation
      - ... and more!
	  
      The target named "all" takes care of everything.
      
      Some 3rd party jar files are required:
      - xmlparserv2.jar from Oracle
      - hsqldb.jar from Hypersonic SQL
	  - sqlitejdbc-v056.jar for SQLite
      - RXTXcomm.jar, for the Java Communication API (Serial ports access)
      All are available for free.
    </echo>
  </target>

</project>
