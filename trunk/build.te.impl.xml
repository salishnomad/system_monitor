<?xml version="1.0"?>
<project name="svn-tide-implementation" basedir="." default="help">
  
  <property file="build.properties"/>

  <property name="te.impl.output.dir" value="te.impl.classes"/>
  <property name="co.dir" value="src.te.impl"/>
  
  <!-- path to the svnant libraries. Usually they will be located in ANT_HOME/lib -->
  <path id="project.classpath">
	<fileset dir="${lib.dir}">
	  <include name="**/*.jar"/>
	</fileset>
  </path>  

  <path id="classpath">
	<fileset dir="all-3rd-party">
	  <include name="**/*.jar"/>
	</fileset>
  </path>  

  <target name="clean">
    <delete dir="${co.dir}"/>  
    <delete dir="${te.impl.output.dir}"/>  
  </target>
  
  <target name="all" depends="clean, co.te.impl, compile.te.impl, copy.te.impl, archive.te.impl"/>

  <target name="co.te.impl">
    <exec executable="${svn.exec}" searchpath="yes">
      <arg value="checkout"/>
      <arg value="http://tide-engine-implementation.googlecode.com/svn/trunk/"/>
      <arg value="${co.dir}"/>
    </exec>
  </target>
  
  <target name="compile.te.impl" description="Compile Java source files" depends="co.te.impl">
    <mkdir dir="${te.impl.output.dir}"/>
    <path id="te.impl.classpath">
      <path refid="classpath"/>
      <pathelement location="all-libs/geomutils.jar"/>
      <pathelement location="all-libs/coreutilities.jar"/>
      <pathelement location="all-libs/almanac.jar"/>
      <pathelement location="all-libs/chartcomponents.jar"/>
      <pathelement location="all-libs/nmeaparser.jar"/>
      <pathelement location="all-libs/nmeareader.jar"/>
      <pathelement location="all-libs/almanac.tools.jar"/>
      <pathelement location="all-libs/tideengine.jar"/>
    </path>
    <javac destdir="${te.impl.output.dir}" classpathref="te.impl.classpath"
           debug="${javac.debug}" nowarn="${javac.nowarn}"
           deprecation="${javac.deprecation}" encoding="Cp1252" source="1.5"
           target="1.5">
      <compilerarg value="-Xlint:unchecked"/>
      <src path="${co.dir}/src"/>
    </javac>
  </target>
  
  <target name="copy.te.impl" description="Copy files to output directory" depends="compile.te.impl">
    <patternset id="copy.patterns">
      <include name="**/*.gif"/>
      <include name="**/*.jpg"/>
      <include name="**/*.jpeg"/>
      <include name="**/*.png"/>
      <include name="**/*.properties"/>
      <include name="**/*.xml"/>
      <include name="**/*-apf.xml"/>
      <include name="**/*.ejx"/>
      <include name="**/*.xcfg"/>
      <include name="**/*.cpx"/>
      <include name="**/*.dcx"/>
      <include name="**/*.sva"/>
      <include name="**/*.wsdl"/>
      <include name="**/*.ini"/>
      <include name="**/*.tld"/>
      <include name="**/*.tag"/>
      <include name="**/*.xlf"/>
      <include name="**/*.xsl"/>
      <include name="**/*.xsd"/>
    </patternset>
    <copy todir="${te.impl.output.dir}">
      <fileset dir="${co.dir}/src">
        <patternset refid="copy.patterns"/>
      </fileset>
    </copy>
  </target>
  
  <target name="archive.te.impl" depends="copy.te.impl">
    <!--exec executable="cmd" output="manifest.mf" append="false" os="Windows XP">
      <arg value="/c"/>
      <arg value="echo"/>
      <arg value="Compile-Date:"/>
      <arg value="%DATE%"/>
      <arg value="%TIME%"/>
    </exec-->
    <mkdir dir="all-libs"/>
    <jar destfile="all-libs/te.impl.jar" compress="true"> <!-- manifest="manifest.mf"-->
      <fileset dir="${te.impl.output.dir}">
        <exclude name="**/*.cdi"/>
      </fileset>
    </jar>
  </target>
  
  <target name="run.tide.xml">
    <path id="te.impl.classpath">
      <path refid="classpath"/>
      <pathelement location="all-libs/coreutilities.jar"/>
      <pathelement location="all-libs/almanac.jar"/>
      <pathelement location="all-libs/chartcomponents.jar"/>
      <pathelement location="all-libs/nmeaparser.jar"/>
      <pathelement location="all-libs/tideengine.jar"/>
      <pathelement location="all-libs/te.impl.jar"/>
    </path>
    <java classname="tideengineimplementation.gui.main.MainDesktop4Test" dir="src.te.impl" fork="yes">
      <classpath refid="te.impl.classpath"/>
	  <jvmarg line="-Dtide.flavor=xml"/>
    </java>
  </target>

  <target name="run.tide.sql">
    <path id="te.impl.classpath">
      <path refid="classpath"/>
      <pathelement location="all-libs/coreutilities.jar"/>
      <pathelement location="all-libs/almanac.jar"/>
      <pathelement location="all-libs/chartcomponents.jar"/>
      <pathelement location="all-libs/nmeaparser.jar"/>
      <pathelement location="all-libs/tideengine.jar"/>
      <pathelement location="all-libs/te.impl.jar"/>
    </path>
    <java classname="tideengineimplementation.gui.main.MainDesktop4Test" dir="./src.te.impl" fork="yes">
      <classpath refid="te.impl.classpath"/>
	  <jvmarg line="-Dtide.flavor=sql"/>
      <jvmarg line="-Ddb.location=./all-db"/>
    </java>
  </target>

  <target name="start.db.server">
    <echo>Will use the parameters in server.properties</echo>
    <java classname="org.hsqldb.Server" dir="./src.te.impl/all-db" fork="yes" spawn="yes">
      <classpath location="./all-3rd-party/hsqldb.jar"/>
    </java>
  </target>
  
  <target name="shutdown.db.server">
    <java jar="./all-3rd-party/hsqldb.jar" dir="." fork="yes" inputstring="tides">
      <arg line="--inLineRc URL=jdbc:hsqldb:hsql://localhost:1234/tides,USER=tides"/>
      <arg line="--sql shutdown;"/>      
    </java>
  </target>
  
  <target name="run.tide.sql.with.server">
    <path id="te.impl.classpath">
      <path refid="classpath"/>
      <pathelement location="all-libs/coreutilities.jar"/>
      <pathelement location="all-libs/almanac.jar"/>
      <pathelement location="all-libs/chartcomponents.jar"/>
      <pathelement location="all-libs/nmeaparser.jar"/>
      <pathelement location="all-libs/tideengine.jar"/>
      <pathelement location="all-libs/te.impl.jar"/>
    </path>
    <java classname="tideengineimplementation.gui.main.MainDesktop4Test" dir="." fork="yes">
      <classpath refid="te.impl.classpath"/>
      <jvmarg line="-Dtide.flavor=sql"/>
      <jvmarg line="-Ddb.location=//localhost:1234/tides"/>
    </java>
  </target>

</project>
